"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.connectorWithCache = connectorWithCache;

var _path = _interopRequireDefault(require("path"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _objectHash = _interopRequireDefault(require("object-hash"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const cacheDir = '.cache';

function connectorWithCache(connector) {
  const decorated = async params => {
    const cachePath = _path.default.join(cacheDir, `${(0, _objectHash.default)(params)}.json`);

    if (await _fsExtra.default.pathExists(cachePath)) {
      return _fsExtra.default.readJSON(cachePath);
    }

    const [result] = await Promise.all([connector(params), _fsExtra.default.mkdirs(cacheDir)]);
    await _fsExtra.default.writeJSON(cachePath, result);
    return result;
  };

  decorated.clearCache = () => _fsExtra.default.remove(cacheDir);

  return decorated;
}