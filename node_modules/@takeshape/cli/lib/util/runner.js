"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createRunner = createRunner;

var _chalk = _interopRequireDefault(require("chalk"));

var _formatError = _interopRequireDefault(require("./format-error"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function createRunner(name, task) {
  let running = false;
  return async (...args) => {
    if (!running) {
      running = true;
      const startTime = Date.now();
      console.log(`${name} - Started!`);

      try {
        const stats = await task(...args);
        const totalSeconds = (Date.now() - startTime) / 1000;
        console.log(`${name} - ` + _chalk.default.green(`Generated ${stats.pagesGenerated} pages in ${totalSeconds}s`));
        const warnings = stats.warnings;

        if (warnings && warnings.length) {
          console.log(`${name} - ` + _chalk.default.yellow('Warnings:'));
          warnings.forEach(warning => {
            console.log(_chalk.default.yellow(`${warning.source}: ${warning.message}`));
          });
        }

        running = false;
      } catch (error) {
        console.log(`${name} - ` + _chalk.default.red(`Error:\n${(0, _formatError.default)(error)}`));
        running = false;
      }
    }
  };
}